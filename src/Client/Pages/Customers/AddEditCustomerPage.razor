@using ErpDashboard.Application.Enums
@using ErpDashboard.Client.Pages.Customers.Compnents
@using ErpDashboard.Application.Features.Customer.Quers.GetAllCustomers;



<EditForm Model="Model" OnInvalidSubmit="Save">
	<FluentValidationValidator @ref="_fluentValidationValidator" />

	<MudDialog>
		<TitleContent>
			@if (Model.Id == 0)
			{
				<MudText Typo="Typo.h6">
					<MudIcon Icon="@Icons.Material.Filled.Add" Class="mr-3 mb-n1" />
					Add Customer
				</MudText>
			}
			else
			{
				<MudText Typo="Typo.h6">
					<MudIcon Icon="@Icons.Material.Filled.Edit" Class="mr-3 mb-n1" />
					EditCustomer
				</MudText>
			}
		</TitleContent>
		<DialogContent>
			<MudContainer Style="overflow-y:scroll; max-height:80vh">
				<MudGrid>
					<MudItem md="6" xs="12">
						<MudGrid>
							<MudItem xs="12" md="12">
								<MudTextField For="@(() => Model.CustomerName)" @bind-Value="Model.CustomerName" Label="Customer Name" Variant="Variant.Outlined" />
							</MudItem>
							<MudItem xs="12" md="12">
								<CustomerCategoryCmbCompnents @bind-Myvalue="Model.CategoryId">
								</CustomerCategoryCmbCompnents>
							</MudItem>
							<MudItem xs="12" md="12">
								<MudSelect T="string" For="@(() => Model.RegType)" @bind-Value="Model.RegType" Variant="Variant.Outlined" Label="Regestration Type">
									<MudSelectItem Value="@("Branch")">Branch</MudSelectItem>
									<MudSelectItem Value="@("Web Site")">Web</MudSelectItem>
									<MudSelectItem Value="@("Mobile Application")"></MudSelectItem>
								</MudSelect>
							</MudItem>
							<MudItem xs="12" md="12">
								<MudDatePicker Variant="Variant.Outlined" Label="Birth date" @bind-Date="Model.BirthDate"></MudDatePicker>
							</MudItem>

							<MudItem xs="12" md="12">
								<MudTextField For="@(() => Model.Email)" @bind-Value="Model.Email" Label="Email" Variant="Variant.Outlined" />
							</MudItem>
							<MudItem xs="12" md="6">
								<MudTextField For="@(() => Model.Weight)" @bind-Value="Model.Weight" Label="Weight" Variant="Variant.Outlined" />
							</MudItem>
							<MudItem xs="12" md="6">
								<MudTextField For="@(() => Model.Height)" @bind-Value="Model.Height" Label="Height" Variant="Variant.Outlined" />
							</MudItem>
							<MudItem xs="12" md="12">
								<MudSelect For="@(()=>Model.CustomerType)" Variant="Variant.Outlined" Label="Customer Type" @bind-Value="Model.CustomerType">
									<MudSelectItem Value="@ErpSystemEnums.Customer_Type.Customer">Customer</MudSelectItem>
									<MudSelectItem Value="@ErpSystemEnums.Customer_Type.Sponser">Sponser</MudSelectItem>
								</MudSelect>
							</MudItem>
							<MudItem xs="12" md="12">
								<MudTextField For="@(() => Model.Notes)" @bind-Value="Model.Notes" Label="Notes" Variant="Variant.Outlined" />
							</MudItem>
							<MudItem>
								<MudSwitch Label="Customer State" @bind-Checked="Model.Status" Disabled="false" Color="Color.Tertiary"></MudSwitch>
							</MudItem>
						</MudGrid>
					</MudItem>
					<MudItem md="6" xs="12">
						<MudGrid>
							<MudItem md="12" xs="12">
								<MudCard>
									<MudCardHeader>
										<MudIcon Style="color:green;font-size:2rem" Icon="@Icons.Filled.LocationOn"></MudIcon>
										<HeroTitle Title="Customer Adress"></HeroTitle>
									</MudCardHeader>
									<MudCardContent>
										<MudTable Items="@Model.customerAdresses" Hover="true" Breakpoint="Breakpoint.Sm" Context="adress" Dense="true">
											<HeaderContent>
												<MudTh Style="width:150px">Area</MudTh>
												<MudTh Style="width:200px">Adress</MudTh>
												<MudTh Style="width:30px">Edit</MudTh>
												<MudTh Style="width:30px">Delete</MudTh>
											</HeaderContent>
											<RowTemplate>
												<MudTd DataLabel="Area">@(GetAreaName(adress.AreaId))	</MudTd>
												<MudTd DataLabel="Sign">@adress.Adress</MudTd>
												<MudTd>
													<MudIconButton OnClick="(()=>InvokeAdressModal(adress.Id))" Style="color:dodgerblue" Icon="@Icons.Filled.Edit"></MudIconButton>
												</MudTd>
												<MudTd>
													<MudIconButton Style="color:orangered" Icon="@Icons.Filled.Delete" OnClick="(()=>DeleteAdress(adress.Id))"></MudIconButton>
												</MudTd>
											</RowTemplate>
										</MudTable>
									</MudCardContent>
									<MudCardActions>
										<MudIconButton Style="color:forestgreen" OnClick="(()=>InvokeAdressModal())">Add Adress</MudIconButton>
									</MudCardActions>
								</MudCard>
							</MudItem>
							<MudItem>
								<MudSpacer></MudSpacer>
							</MudItem>
							<MudItem md="12" xs="12">
								<MudCard>
									<MudCardHeader>
										<MudIcon Style="color:darkorange;font-size:3rem;padding-bottom:10px" Icon="@Icons.Filled.Phone"></MudIcon>
										<HeroTitle Title="Customer Phons"></HeroTitle>
									</MudCardHeader>
									<MudCardContent>
										<MudTable Items="@Model.customerPhons" Hover="true" Dense="true" FixedHeader="true" Height="200px" Breakpoint="Breakpoint.Sm" Context="Phons">
											<HeaderContent>
												<MudTh>Phone Type</MudTh>
												<MudTh Style="width:200px">Phone</MudTh>
												<MudTh Style="width:30px">Edit</MudTh>
												<MudTh Style="width:30px">Delete</MudTh>
											</HeaderContent>
											<RowTemplate>
												<MudTd>@Phons.PhoneType</MudTd>
												<MudTd DataLabel="Sign">@Phons.Phone</MudTd>
												<MudTd>
													<MudIconButton Style="color:dodgerblue" Icon="@Icons.Filled.Edit" OnClick="(()=>InvokeModal(Phons.Id))"></MudIconButton>
												</MudTd>
												<MudTd>
													<MudIconButton Style="color:orangered" Icon="@Icons.Filled.Delete" OnClick="(()=> Model.customerPhons.Remove(Phons))"></MudIconButton>
												</MudTd>
											</RowTemplate>
										</MudTable>

									</MudCardContent>
									<MudCardActions>
										<MudIconButton Style="color:orangered" OnClick="(()=>InvokeModal(Customerid:Model.Id))">Add Phone</MudIconButton>
									</MudCardActions>
								</MudCard>
							</MudItem>

						</MudGrid>
					</MudItem>


				</MudGrid>
			</MudContainer>
		</DialogContent>
		<DialogActions>
			<MudButton DisableElevation Variant="Variant.Filled" Style="width:150px;background-color:lightcoral;color:white" OnClick="Cancel">Cancel</MudButton>
			<MudButton DisableElevation Style="background-color:green;width:150px"  Variant="Variant.Filled" OnClick="Save"Disabled="@(string.IsNullOrEmpty(Model.CustomerName) ||
			string.IsNullOrEmpty(Model.Weight) ||string.IsNullOrEmpty(Model.Height))" ButtonType="ButtonType.Submit" Color="Color.Secondary">@(Model.Id == 0?"Add":"Save")</MudButton>
		</DialogActions>
	</MudDialog>
</EditForm>

@code {
	private FluentValidationValidator _fluentValidationValidator;
	private bool Validated => _fluentValidationValidator.Validate(options => { options.IncludeAllRuleSets(); });

}
